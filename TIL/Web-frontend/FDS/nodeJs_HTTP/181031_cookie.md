# 181031 TIL cookie

시작하기 전에 서버와 통신을 하기 위해서 아래있는 것들은 숙지해야 한다.

- Cookie
- Ajax
- CORS
- JWT
- Fetch API
- HTTP Cache
- GraphQL

---

## cookie

브라우저는 고객이 로그인을 해야 다음 화면을 출력해주는데 그 로그인된 정보를 어떻게 알까? 개별 클라이언트의 여러 요청에 걸친 정보를 유지해야한다.

- 장바구니 (권장하지 않음)
- 로그인/로그아웃
- 방문기록
- 등등..

### HTTP Cookie

- **서버가 응답을 통해 웹 브라우저에 저장하는** 이름+값 형태의 정보이다.
- 웹 브라우저는 쿠키를 저장하기 위한 저장소를 가지고 있고, 그 저장소는 자료의 유효기간솨 접근 권한에 대한 다양한 옵션을 제공한다.

> 개발자 도구 => 어플리케이션 => 쿠키

---

### 쿠기 전송 절차

1. 서버는 브라우저에 저장하고 싶은 정보를 응답과 같이 실어 보낸다 (Set-Cookie 헤더)

```js
HTTP/1.1 200 OK
Set-Cookie: cookieName=cookieValue; Secure; Max-Age=60000
```

2. 브라우저는 같은 서버에 요청이 일어날 때마다 해당 정보를 요청에 같이 실어서 서버에 보낸다 (Cookie 헤더)

```js
GET / HTTP/1.1
Cookie: cookieName=cookieValue; anotherName=anotherValue
...
```

---

### Set-Cookie Options

- `Expires, Max-Age`: 쿠키의 지속시간 설정 

    *(ex)10분 동안만 로그인이 유효한*

- `Secure`: HTTPS를 통해서만 쿠키가 전송되도록 설정

- `HttpOnly`: 자바스크립트에서 쿠키를 읽지 못하도록 설정

    *해커가 스크립트를 삽입해 쿠키를 읽어와서 해커에게 전송 할 수 있다. 때문에 HttpOnly를 항상 설정하여 javascript로는 쿠키를 건드리지 않는 것이 best practice이다.*

- `Domain, Path`: 쿠키의 scope 설정 (쿠키가 전송되는 URL을 제한)

    *A사이트에서만 전송하는 쿠키가 있어야하고, B사이트에서만 전송하는 쿠키가 있어야 한다. 그 범위를 제한한다.*

> Express에도 Cookie를 저장하는 내장기능이 있다.

[쿠키 예제](https://glitch.com/edit/#!/slime-badger?path=server.js:10:47)

---

### 쿠키의 한계점

- US-ASCII 밖에 저장하지 못하기 때문에 보통 퍼센트 인코딩(percent encoding)을 사용한다.

- 저장 용량이 작다. (4000 바이트 내외 = 영문 4000자, percent encoding 된 한글 444자 가량)

- 브라우저에 저장되기 때문에, 여러 브라우저에 걸쳐 공유되어야 하는 정보 혹은 웹 브라우저가 아닌 클라이언트(모바일 앱)에 저장되어야 하는 정보는 다루기에 부벅절하다.

> 쿠키는 컴퓨터에 저장되기 때문에 쇼핑몽 장바구니와 같은 정보는 쿠키에 담지 않는다. 보통 아이다ㅏ 패스워드나, 인증 토큰을 쿠키에 저장한다.

> 쿠키는 전통적 방법이기 때문에 많이 쓰이지 않을 수 있지만, 어떤 프로젝트, 어떤 회사에 가느냐에 따라 쿠키를 많이 다룰 수도 있다.